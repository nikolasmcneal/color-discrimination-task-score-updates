<!-- <!DOCTYPE html> -->
<html>

<head>
  <script src="jspsych/jspsych.js"></script>
  <script src="jspsych/plugins/jquery-3.5.1.min.js"></script>
  <script src="jspsych/plugins/jspsych-blocks.js"></script>
  <script src="jspsych/plugins/jspsych-image-keyboard-response.js"></script>
  <script src="jspsych/plugins/jspsych-rainbowimage-keyboard-response.js"></script>
  <script src="jspsych/plugins/jspsych-blocks-exp.js"></script>
  <script src="jspsych/plugins/jspsych-image-button-response.js"></script>
  <script src="jspsych/plugins/jspsych-rainbow.js"></script>
  <script src="jspsych/plugins/jspsych-call-function.js"></script>
  <script src="jspsych/plugins/jspsych-reward-function.js"></script>
  <script src="jspsych/plugins/jspsych-call.js"></script>
  <script src="jspsych/plugins/jspsych-fullscreen.js"></script>
  <script src="jspsych/plugins/jspsych-memslider.js"></script>
  <script src="jspsych/plugins/jspsych-memchoice.js"></script>
  <script src="jspsych/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych/plugins/jspsych-survey-text.js"></script>
  <script src="jspsych/plugins/jspsych-image-slider-response.js"></script>
  <script src="jspsych/plugins/jspsych-blocks-prac-fixed.js"></script>
  <script src="jspsych/plugins/jspsych-blocks-prac-VB.js"></script>

  <link rel="stylesheet" href="jspsych/css/jspsych.css" />
</head>

<body></body>
<script>
  var subject_id = jsPsych.randomization.randomID(9);
  var n = 3; //number of training trials // 30
  var z = 1; //number of practice trials // 10
  var rep = 15; //number of experiment trials //150
  var num_curr_score = 3 //number of trials between showing current score //30
  var fixedfirst = true; //which condition the experiment will run
  var training_fixed_static = true //if true, then FR training is 27/0. if false, then FR training shows value of selected item
  var toggle; //toggle memory on

  if (fixedfirst) {
    // look at what the average accuracy is in FR , multiply that by average stimulus value. round to the nearest $.05.
    var conversion_rate = 450.00; //number of points per dollar //this assumes the average accuracy in FR is .85, and the correct payout is X
    //(150 * 35) = 5250
    //5250 * .85 = 4462
    //4462 / x = 10
    //x = 446 -> round to 450
  }
  if (fixedfirst == false) {
    var conversion_rate = 450.00; // set value-based conversion rate first (avg = 33)
 
  }
  const fixation_duration = 500;

  //total reward should be around $10

  //fixed reward feedback
  //total earnings: points, and then underneath in dollars
  // 4 points per dollar
  // 2100 points / 4 = your current earnings are $550



  var timeline = [];
  var col1 = [];


  //chrome, opera, edge, firefox
  var isChrome;
  var checkBrowser = function () {
    if (navigator.userAgent.indexOf("Chrome") != -1) {
      isChrome = true;
    } else {
      isChrome = false;
    }
  };
  var checkBrowsercall = {
    type: "call-function",
    func: checkBrowser,
  };
  timeline.push(checkBrowsercall)


  var browser_fail = {
    type: 'html-keyboard-response',
    stimulus: `<p>Oops! It looks like you aren't using the Google Chrome browser.  </p>
            <p>Please make sure that you complete this experiment in Google Chrome.</p>
            <p>The experiment will now end. Press any key to continue.</p>`,
    choices: jsPsych.ALL_KEYS,
    on_finish: function (data) {
      jsPsych.endExperiment();
    }
  }


  //Conditional Browser
  var conditional_browser = {
    timeline: [browser_fail],
    conditional_function: function () {
      if (!isChrome) {
        return true;
      } else {
        return false;
      }
    },
  };
  timeline.push(conditional_browser)


  // Enter fullscreen:
  timeline.push({
    type: "fullscreen",
    fullscreen_mode: true,
    message: `<p>Before we begin, please close any unnecessary programs or applications on your computer. This will help the study run more smoothly.</p>
               <p>Also, please close any browser tabs that could produce popups or alerts that would interfere with the study. Finally, once the study</p>
               <p>has started, DO NOT EXIT fullscreen mode or you will terminate the study and not receive any payment.</p>
               <p>The study will switch to full screen mode when you press the button below. When you are ready to begin, press the button.</p>`
  });

  var cursor_off = {
    type: "call-function",
    func: function () {
      document.body.style.cursor = "none";
    },
  };

  var cursor_on = {
    type: "call-function",
    func: function () {
      document.body.style.cursor = "auto";
    },
  };

  // var fixedfirst = true;
  // if (Math.random() > 0.5) {
  //   fixedfirst = true;
  // } else {
  //   fixedfirst = false;
  // }

  //Reward
  acc_reward = 35;

  var fixation = {
    type: "html-keyboard-response",
    stimulus: '<div style="font-size:60px;">+</div>',
    choices: jsPsych.NO_KEYS,
    trial_duration: fixation_duration,
  };

  var pinktoblue = true;
  var bluetopink = false;
  var greentoorange = true;
  var orangetogreen = false;
  var anchors = [];
  var anchors_two = []
  //pink to blue
  var colors = [
    'rgb(243,39,122)',
    'rgb(237,48,137)',
    'rgb(227,61,152)',
    'rgb(214,75,165)',
    'rgb(198,87,175)',
    'rgb(179,99,183)',
    'rgb(158,109,188)',
    'rgb(136,118,190)',
    'rgb(113,126,188)',
    'rgb(91,132,182)',
    'rgb(70,136,174)',
    'rgb(53,139,162)'
  ];

  //blue to pink
  if (Math.random() > 0.5) {
    colors.reverse();
    pinktoblue = false;
    bluetopink = true;
  }

  //green to orange -- doesn't matter
  var colors2 = ['rgb(227.0, 78.0, 50.0)',
    'rgb(207.0, 98.0, 30.0)',
    'rgb(182.0, 114.0, 19.0)',
    'rgb(156.0, 126.0, 26.0)',
    'rgb(129.0, 134.0, 46.0)',
    'rgb(102.0, 140.0, 71.0)',
    'rgb(76.0, 143.0, 98.0)',
    'rgb(53.0, 143.0, 126.0)',
    'rgb(46.0, 141.0, 151.0)',
    'rgb(67.0, 137.0, 172.0)',
    'rgb(102.0, 129.0, 185.0)',
    'rgb(140.0, 117.0, 190.0)']

  //orange to green
  if (Math.random() > 0.5) {
    greentoorange = false;
    orangetogreen = true;
    colors2.reverse();
  }

  var BPfirst = false;
  var GOfirst = false;


  var BPfirst = true;
  col1 = colors
  // if (Math.random() > 0.5) {
  //   col1 = colors; //BP
  //   BPfirst = true;
  // } else {
  //   col1 = colors2; //GO
  //   GOfirst = true;
  // }

  // BPfirst = true;
  // col1 = colors;

  rainbow_one = []
  rainbow_two = []
  rainbow_BP = ["img/rainbows/BP.png", "blue", "pink"]
  rainbow_PB = ["img/rainbows/PB.png", "pink", "blue"]
  rainbow_OG = ["img/rainbows/OG.jpg", "orange", "green"]
  rainbow_GO = ["img/rainbows/GO.jpg", "green", "orange"]

  var log_rainbow = {
    type: "call",
    func: function () { },
    on_finish: function (data) {
      if (BPfirst) {
        if (bluetopink) {
          data.first_rainbow = "Blue to Pink";
          anchors = ['img/anchors/blue.jpg', 'img/anchors/pink.jpg']
          example_current = example_BP
          rainbow_one = rainbow_BP
        }
        if (pinktoblue) {
          data.first_rainbow = "Pink to Blue";
          anchors = ['img/anchors/pink.jpg', 'img/anchors/blue.jpg']
          example_current = example_PB
          rainbow_one = rainbow_PB
        }
        if (greentoorange) {
          data.second_rainbow = "Green to Orange";
          anchors_two = ['img/anchors/green.jpg', 'img/anchors/orange.jpg']
          example_current_2 = example_GO
          rainbow_two = rainbow_GO
        }
        if (orangetogreen) {
          data.second_rainbow = "Orange to Green";
          anchors_two = ['img/anchors/orange.jpg', 'img/anchors/green.jpg']
          example_current_2 = example_OG
          rainbow_two = rainbow_OG
        }
      }
      if (GOfirst) {
        if (greentoorange) {
          data.first_rainbow = "Green to Orange";
          anchors = ['img/anchors/green.jpg', 'img/anchors/orange.jpg']
          example_current = example_GO
          rainbow_one = rainbow_GO
        }
        if (orangetogreen) {
          data.first_rainbow = "Orange to Green";
          anchors = ['img/anchors/orange.jpg', 'img/anchors/green.jpg']
          example_current = example_OG
          rainbow_one = rainbow_OG
        }
        if (bluetopink) {
          data.second_rainbow = "Blue to Pink";
          anchors_two = ['img/anchors/blue.jpg', 'img/anchors/pink.jpg']
          example_current_2 = example_BP
          rainbow_two = rainbow_BP
        }
        if (pinktoblue) {
          data.second_rainbow = "Pink to Blue";
          anchors_two = ['img/anchors/pink.jpg', 'img/anchors/blue.jpg']
          example_current_2 = example_PB
          rainbow_two = rainbow_PB
        }
      }
    },
  };
  timeline.push(log_rainbow);
  var arr_left;

  var arrays1 = [[[1, 0, 4, 4, 6, 3], [4, 1, 1, 3, 6, 7]],
 [[3, 2, 3, 1, 3, 7], [0, 6, 4, 6, 3, 3]],
 [[6, 3, 7, 7, 2, 0], [7, 6, 5, 2, 4, 4]],
 [[7, 7, 5, 3, 5, 1], [7, 5, 4, 0, 4, 7]],
 [[6, 7, 5, 0, 7, 0], [1, 3, 6, 3, 2, 6]],
 [[5, 7, 2, 1, 5, 2], [5, 2, 7, 2, 5, 6]],
 [[0, 1, 6, 3, 4, 4], [3, 1, 6, 6, 0, 7]],
 [[1, 2, 6, 3, 6, 0], [6, 7, 5, 0, 1, 0]],
 [[1, 7, 4, 3, 2, 2], [3, 0, 7, 3, 4, 1]],
 [[0, 2, 4, 3, 4, 5], [5, 3, 6, 1, 2, 6]],
 [[2, 2, 6, 4, 3, 7], [7, 4, 1, 0, 1, 6]],
 [[7, 5, 6, 0, 6, 6], [5, 5, 7, 3, 7, 4]],
 [[0, 7, 2, 3, 0, 7], [6, 2, 2, 3, 6, 5]],
 [[3, 1, 1, 7, 5, 7], [1, 4, 6, 4, 2, 1]],
 [[2, 4, 5, 7, 6, 5], [0, 6, 3, 6, 7, 5]],
 [[1, 4, 4, 4, 3, 7], [7, 5, 5, 5, 0, 4]],
 [[7, 3, 2, 2, 5, 5], [7, 6, 4, 0, 4, 0]],
 [[7, 2, 1, 7, 2, 1], [3, 6, 5, 3, 6, 3]],
 [[1, 3, 3, 5, 4, 2], [1, 6, 5, 2, 6, 0]],
 [[0, 3, 1, 3, 6, 7], [5, 5, 2, 1, 3, 6]],
 [[0, 5, 4, 4, 2, 6], [0, 3, 4, 7, 5, 0]],
 [[0, 0, 1, 7, 3, 7], [2, 7, 7, 1, 2, 5]],
 [[5, 3, 6, 4, 7, 0], [3, 4, 0, 5, 1, 6]],
 [[7, 4, 0, 7, 4, 2], [3, 4, 5, 0, 5, 4]],
 [[2, 1, 6, 4, 6, 6], [0, 6, 0, 5, 6, 4]],
 [[4, 3, 5, 0, 0, 6], [4, 6, 7, 1, 1, 3]],
 [[1, 3, 4, 3, 7, 7], [7, 7, 5, 7, 3, 1]],
 [[6, 2, 1, 3, 7, 2], [6, 2, 4, 3, 1, 3]],
 [[3, 1, 7, 7, 3, 4], [6, 2, 5, 2, 1, 5]],
 [[2, 2, 2, 6, 4, 6], [6, 5, 2, 6, 6, 2]],
 [[4, 6, 1, 0, 2, 7], [0, 4, 6, 1, 5, 2]],
 [[4, 2, 1, 5, 2, 7], [0, 2, 5, 4, 5, 6]],
 [[0, 1, 7, 1, 7, 3], [5, 6, 5, 2, 2, 1]],
 [[6, 3, 6, 6, 1, 6], [5, 5, 3, 7, 7, 3]],
 [[3, 2, 2, 0, 4, 7], [5, 5, 0, 2, 1, 7]],
 [[4, 6, 3, 5, 7, 6], [6, 7, 2, 5, 4, 6]],
 [[6, 2, 5, 0, 4, 6], [0, 7, 3, 4, 0, 5]],
 [[4, 0, 6, 1, 4, 4], [6, 0, 6, 3, 3, 4]],
 [[3, 5, 4, 4, 1, 7], [2, 6, 5, 3, 1, 1]],
 [[5, 1, 2, 6, 7, 6], [4, 3, 1, 3, 6, 5]],
 [[4, 6, 1, 6, 2, 4], [7, 1, 7, 7, 4, 3]],
 [[6, 3, 0, 6, 7, 5], [3, 1, 0, 6, 6, 7]],
 [[1, 2, 6, 6, 4, 3], [3, 5, 6, 2, 3, 4]],
 [[5, 7, 5, 7, 1, 0], [6, 0, 3, 7, 3, 7]],
 [[4, 5, 1, 4, 5, 6], [2, 4, 2, 4, 6, 5]],
 [[7, 7, 0, 0, 1, 6], [5, 7, 3, 2, 5, 5]],
 [[3, 7, 5, 1, 3, 4], [5, 1, 7, 6, 4, 1]],
 [[5, 3, 4, 4, 5, 3], [4, 0, 4, 7, 4, 7]],
 [[7, 1, 6, 7, 4, 0], [1, 5, 7, 1, 3, 2]],
 [[3, 4, 4, 0, 7, 5], [7, 0, 1, 2, 3, 7]],
 [[3, 2, 6, 6, 8, 5], [6, 3, 3, 5, 8, 9]],
 [[5, 4, 5, 3, 5, 9], [2, 8, 6, 8, 5, 5]],
 [[8, 5, 9, 9, 4, 2], [9, 8, 7, 4, 6, 6]],
 [[9, 9, 7, 5, 7, 3], [9, 7, 6, 2, 6, 9]],
 [[8, 9, 7, 2, 9, 2], [3, 5, 8, 5, 4, 8]],
 [[7, 9, 4, 3, 7, 4], [7, 4, 9, 4, 7, 8]],
 [[2, 3, 8, 5, 6, 6], [5, 3, 8, 8, 2, 9]],
 [[3, 4, 8, 5, 8, 2], [8, 9, 7, 2, 3, 2]],
 [[3, 9, 6, 5, 4, 4], [5, 2, 9, 5, 6, 3]],
 [[2, 4, 6, 5, 6, 7], [7, 5, 8, 3, 4, 8]],
 [[4, 4, 8, 6, 5, 9], [9, 6, 3, 2, 3, 8]],
 [[9, 7, 8, 2, 8, 8], [7, 7, 9, 5, 9, 6]],
 [[2, 9, 4, 5, 2, 9], [8, 4, 4, 5, 8, 7]],
 [[5, 3, 3, 9, 7, 9], [3, 6, 8, 6, 4, 3]],
 [[4, 6, 7, 9, 8, 7], [2, 8, 5, 8, 9, 7]],
 [[3, 6, 6, 6, 5, 9], [9, 7, 7, 7, 2, 6]],
 [[9, 5, 4, 4, 7, 7], [9, 8, 6, 2, 6, 2]],
 [[9, 4, 3, 9, 4, 3], [5, 8, 7, 5, 8, 5]],
 [[3, 5, 5, 7, 6, 4], [3, 8, 7, 4, 8, 2]],
 [[2, 5, 3, 5, 8, 9], [7, 7, 4, 3, 5, 8]],
 [[2, 7, 6, 6, 4, 8], [2, 5, 6, 9, 7, 2]],
 [[2, 2, 3, 9, 5, 9], [4, 9, 9, 3, 4, 7]],
 [[7, 5, 8, 6, 9, 2], [5, 6, 2, 7, 3, 8]],
 [[9, 6, 2, 9, 6, 4], [5, 6, 7, 2, 7, 6]],
 [[4, 3, 8, 6, 8, 8], [2, 8, 2, 7, 8, 6]],
 [[6, 5, 7, 2, 2, 8], [6, 8, 9, 3, 3, 5]],
 [[3, 5, 6, 5, 9, 9], [9, 9, 7, 9, 5, 3]],
 [[8, 4, 3, 5, 9, 4], [8, 4, 6, 5, 3, 5]],
 [[5, 3, 9, 9, 5, 6], [8, 4, 7, 4, 3, 7]],
 [[4, 4, 4, 8, 6, 8], [8, 7, 4, 8, 8, 4]],
 [[6, 8, 3, 2, 4, 9], [2, 6, 8, 3, 7, 4]],
 [[6, 4, 3, 7, 4, 9], [2, 4, 7, 6, 7, 8]],
 [[2, 3, 9, 3, 9, 5], [7, 8, 7, 4, 4, 3]],
 [[8, 5, 8, 8, 3, 8], [7, 7, 5, 9, 9, 5]],
 [[5, 4, 4, 2, 6, 9], [7, 7, 2, 4, 3, 9]],
 [[6, 8, 5, 7, 9, 8], [8, 9, 4, 7, 6, 8]],
 [[8, 4, 7, 2, 6, 8], [2, 9, 5, 6, 2, 7]],
 [[6, 2, 8, 3, 6, 6], [8, 2, 8, 5, 5, 6]],
 [[5, 7, 6, 6, 3, 9], [4, 8, 7, 5, 3, 3]],
 [[7, 3, 4, 8, 9, 8], [6, 5, 3, 5, 8, 7]],
 [[6, 8, 3, 8, 4, 6], [9, 3, 9, 9, 6, 5]],
 [[8, 5, 2, 8, 9, 7], [5, 3, 2, 8, 8, 9]],
 [[3, 4, 8, 8, 6, 5], [5, 7, 8, 4, 5, 6]],
 [[7, 9, 7, 9, 3, 2], [8, 2, 5, 9, 5, 9]],
 [[6, 7, 3, 6, 7, 8], [4, 6, 4, 6, 8, 7]],
 [[9, 9, 2, 2, 3, 8], [7, 9, 5, 4, 7, 7]],
 [[5, 9, 7, 3, 5, 6], [7, 3, 9, 8, 6, 3]],
 [[7, 5, 6, 6, 7, 5], [6, 2, 6, 9, 6, 9]],
 [[9, 3, 8, 9, 6, 2], [3, 7, 9, 3, 5, 4]],
 [[5, 6, 6, 2, 9, 7], [9, 2, 3, 4, 5, 9]],
 [[5, 4, 8, 8, 10, 7], [8, 5, 5, 7, 10, 11]],
 [[7, 6, 7, 5, 7, 11], [4, 10, 8, 10, 7, 7]],
 [[10, 7, 11, 11, 6, 4], [11, 10, 9, 6, 8, 8]],
 [[11, 11, 9, 7, 9, 5], [11, 9, 8, 4, 8, 11]],
 [[10, 11, 9, 4, 11, 4], [5, 7, 10, 7, 6, 10]],
 [[9, 11, 6, 5, 9, 6], [9, 6, 11, 6, 9, 10]],
 [[4, 5, 10, 7, 8, 8], [7, 5, 10, 10, 4, 11]],
 [[5, 6, 10, 7, 10, 4], [10, 11, 9, 4, 5, 4]],
 [[5, 11, 8, 7, 6, 6], [7, 4, 11, 7, 8, 5]],
 [[4, 6, 8, 7, 8, 9], [9, 7, 10, 5, 6, 10]],
 [[6, 6, 10, 8, 7, 11], [11, 8, 5, 4, 5, 10]],
 [[11, 9, 10, 4, 10, 10], [9, 9, 11, 7, 11, 8]],
 [[4, 11, 6, 7, 4, 11], [10, 6, 6, 7, 10, 9]],
 [[7, 5, 5, 11, 9, 11], [5, 8, 10, 8, 6, 5]],
 [[6, 8, 9, 11, 10, 9], [4, 10, 7, 10, 11, 9]],
 [[5, 8, 8, 8, 7, 11], [11, 9, 9, 9, 4, 8]],
 [[11, 7, 6, 6, 9, 9], [11, 10, 8, 4, 8, 4]],
 [[11, 6, 5, 11, 6, 5], [7, 10, 9, 7, 10, 7]],
 [[5, 7, 7, 9, 8, 6], [5, 10, 9, 6, 10, 4]],
 [[4, 7, 5, 7, 10, 11], [9, 9, 6, 5, 7, 10]],
 [[4, 9, 8, 8, 6, 10], [4, 7, 8, 11, 9, 4]],
 [[4, 4, 5, 11, 7, 11], [6, 11, 11, 5, 6, 9]],
 [[9, 7, 10, 8, 11, 4], [7, 8, 4, 9, 5, 10]],
 [[11, 8, 4, 11, 8, 6], [7, 8, 9, 4, 9, 8]],
 [[6, 5, 10, 8, 10, 10], [4, 10, 4, 9, 10, 8]],
 [[8, 7, 9, 4, 4, 10], [8, 10, 11, 5, 5, 7]],
 [[5, 7, 8, 7, 11, 11], [11, 11, 9, 11, 7, 5]],
 [[10, 6, 5, 7, 11, 6], [10, 6, 8, 7, 5, 7]],
 [[7, 5, 11, 11, 7, 8], [10, 6, 9, 6, 5, 9]],
 [[6, 6, 6, 10, 8, 10], [10, 9, 6, 10, 10, 6]],
 [[8, 10, 5, 4, 6, 11], [4, 8, 10, 5, 9, 6]],
 [[8, 6, 5, 9, 6, 11], [4, 6, 9, 8, 9, 10]],
 [[4, 5, 11, 5, 11, 7], [9, 10, 9, 6, 6, 5]],
 [[10, 7, 10, 10, 5, 10], [9, 9, 7, 11, 11, 7]],
 [[7, 6, 6, 4, 8, 11], [9, 9, 4, 6, 5, 11]],
 [[8, 10, 7, 9, 11, 10], [10, 11, 6, 9, 8, 10]],
 [[10, 6, 9, 4, 8, 10], [4, 11, 7, 8, 4, 9]],
 [[8, 4, 10, 5, 8, 8], [10, 4, 10, 7, 7, 8]],
 [[7, 9, 8, 8, 5, 11], [6, 10, 9, 7, 5, 5]],
 [[9, 5, 6, 10, 11, 10], [8, 7, 5, 7, 10, 9]],
 [[8, 10, 5, 10, 6, 8], [11, 5, 11, 11, 8, 7]],
 [[10, 7, 4, 10, 11, 9], [7, 5, 4, 10, 10, 11]],
 [[5, 6, 10, 10, 8, 7], [7, 9, 10, 6, 7, 8]],
 [[9, 11, 9, 11, 5, 4], [10, 4, 7, 11, 7, 11]],
 [[8, 9, 5, 8, 9, 10], [6, 8, 6, 8, 10, 9]],
 [[11, 11, 4, 4, 5, 10], [9, 11, 7, 6, 9, 9]],
 [[7, 11, 9, 5, 7, 8], [9, 5, 11, 10, 8, 5]],
 [[9, 7, 8, 8, 9, 7], [8, 4, 8, 11, 8, 11]],
 [[11, 5, 10, 11, 8, 4], [5, 9, 11, 5, 7, 6]],
 [[7, 8, 8, 4, 11, 9], [11, 4, 5, 6, 7, 11]]]
  var arrays;

  // if (Math.random() > 0.5) {
  //   arrays = arrays1;
  // } else {
  //   arrays = arrays2;
  // }

  arrays = arrays1

  function shuffle(arr) {
    var currentIndex = arr.length,
      randomIndex;
    while (0 !== currentIndex) {
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex--;

      [arr[currentIndex], arr[randomIndex]] = [
        arr[randomIndex],
        arr[currentIndex],
      ];
    }

    return arr;
  }

  function swap(arrays) {
    for (var i = 0; i < arrays.length; i++) {
      if (Math.random() > 0.5) {
        var tmp = arrays[i][1];
        arrays[i][1] = arrays[i][0];
        arrays[i][0] = tmp;
      }
    }
  }

  shuffle(arrays); //shuffle order of trials
  swap(arrays); //shuffle L or R

  var indexx = 0;
  var indexx2 = 0;

  function rnd_array(arrays) {
    var idx_array = arrays[indexx][0];
    indexx++;
    return idx_array;
  }

  function rnd_array2(arrays) {
    var idx_array = arrays[indexx2][1];
    indexx2++;
    return idx_array;
  }
  var empt = [];

  function drawRectLexp(c) {
    j = 0;
    var arr_left = rnd_array(arrays);
    arr_left = shuffle(arr_left);
    empt[indexx] = arr_left;
    var ctx = c.getContext("2d");
    ctx.beginPath();

    ctx.fillStyle = col1[arr_left[0]];
    ctx.fillRect(0, 0, 100, 100);

    ctx.fillStyle = col1[arr_left[1]];
    ctx.fillRect(125, 0, 100, 100);

    ctx.fillStyle = col1[arr_left[2]];
    ctx.fillRect(250, 0, 100, 100);

    ctx.fillStyle = col1[arr_left[3]];
    ctx.fillRect(0, 125, 100, 100);

    ctx.fillStyle = col1[arr_left[4]];
    ctx.fillRect(125, 125, 100, 100);

    ctx.fillStyle = col1[arr_left[5]];
    ctx.fillRect(250, 125, 100, 100);

    for (var i = 0; i < 6; ++i) {
      j += arr_left[i] + 1;
    }
    arr_L = [
      arr_left[0] + 1,
      arr_left[1] + 1,
      arr_left[2] + 1,
      arr_left[3] + 1,
      arr_left[4] + 1,
      arr_left[5] + 1,

      //console.log("left: " + j)
    ];
  }

  function drawRectRexp(d) {
    w = 0;

    var arr_right = rnd_array2(arrays);
    arr_right = shuffle(arr_right);
    empt[indexx2] = arr_right;

    var ctx = d.getContext("2d");
    ctx.beginPath();

    ctx.fillStyle = col1[arr_right[0]];
    ctx.fillRect(0, 0, 100, 100);

    ctx.fillStyle = col1[arr_right[1]];
    ctx.fillRect(125, 0, 100, 100);

    ctx.fillStyle = col1[arr_right[2]];
    ctx.fillRect(250, 0, 100, 100);

    ctx.fillStyle = col1[arr_right[3]];
    ctx.fillRect(0, 125, 100, 100);

    ctx.fillStyle = col1[arr_right[4]];
    ctx.fillRect(125, 125, 100, 100);

    ctx.fillStyle = col1[arr_right[5]];
    ctx.fillRect(250, 125, 100, 100);

    for (var z = 0; z < arr_right.length; ++z) {
      w += arr_right[z] + 1;
      // arr_right[z] = arr_right[z]+1
    }
    arr_R = [
      arr_right[0] + 1,
      arr_right[1] + 1,
      arr_right[2] + 1,
      arr_right[3] + 1,
      arr_right[4] + 1,
      arr_right[5] + 1,
    ];
    //console.log("arr_R :" + w)
  }

  var j = 0;
  var w = 0;
  var trial_count = 1;

  var arr_L;
  var arr_R;

  function rainbow(z) {
    var test = 0;

    var ctx = z.getContext("2d");
    ctx.beginPath();

    ctx.fillStyle = col1[0];
    ctx.fillRect(125, 0, 100, 100);

    ctx.fillStyle = col1[1];
    ctx.fillRect(250, 0, 100, 100);

    ctx.fillStyle = col1[2];
    ctx.fillRect(375, 0, 100, 100);

    ctx.fillStyle = col1[3];
    ctx.fillRect(500, 0, 100, 100);

    ctx.fillStyle = col1[4];
    ctx.fillRect(625, 0, 100, 100);

    ctx.fillStyle = col1[5];
    ctx.fillRect(750, 0, 100, 100);

    ctx.fillStyle = col1[6];
    ctx.fillRect(875, 0, 100, 100);

    ctx.fillStyle = col1[7];
    ctx.fillRect(1000, 0, 100, 100);

    // ctx.fillStyle = colors[8];
    // ctx.fillRect(1000, 0, 100, 100);

    // ctx.fillStyle = colors[9];
    // ctx.fillRect(1125, 0, 100, 100);

    // console.log("RAINBOW")
  }

  function rainbow_values(rv) {
    var ctx = rv.getContext("2d");
    ctx.font = "36px Times New Roman, sans-serif";
    ctx.fillStyle = "white";
    var n = 290 - 165;

    //ctx.fillText("1", 40, 50);
    ctx.fillText("1", 165, 50);
    ctx.fillText("2", 290, 50);
    ctx.fillText("3", 290 + n, 50);
    ctx.fillText("4", 290 + 2 * n, 50);
    ctx.fillText("5", 290 + 3 * n, 50);
    ctx.fillText("6", 290 + 4 * n, 50);
    ctx.fillText("7", 290 + 5 * n, 50);
    ctx.fillText("8", 290 + 6 * n, 50);
    // ctx.fillText("10", 290 + 7*n - 20, 50);
  }

  function rainbow_text(rv) {
    var ctx = rv.getContext("2d");
    ctx.font = "24px Times New Roman, sans-serif";
    ctx.fillStyle = "white";
    // ctx.textAlign = 'center';
    //ctx.fillText("Colors farther to the right are worth more points.", 140, 50);
    ctx.fillText("Press the SPACE BAR to continue.", 450, 50);
  }

  function drawRectL(c, arr_left) {
    j = 0;

    var ctx = c.getContext("2d");
    ctx.beginPath();

    // var g = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[g];
    // console.log(arr_left)
    ctx.fillStyle = col1[arr_left[0]];
    ctx.fillRect(0, 0, 100, 100);

    // var h = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[h];
    ctx.fillStyle = col1[arr_left[1]];
    ctx.fillRect(125, 0, 100, 100);

    // var i = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[i];
    ctx.fillStyle = col1[arr_left[2]];
    ctx.fillRect(250, 0, 100, 100);

    // var j = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[j];
    ctx.fillStyle = col1[arr_left[3]];
    ctx.fillRect(0, 125, 100, 100);

    // var k = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[k];
    ctx.fillStyle = col1[arr_left[4]];
    ctx.fillRect(125, 125, 100, 100);

    // var l = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[l];
    ctx.fillStyle = col1[arr_left[5]];
    ctx.fillRect(250, 125, 100, 100);

    // arr_L = [a, b, c, d, e, f]
    for (var i = 0; i < arr_left.length; ++i) {
      j += arr_left[i] + 1;
    }
    arr_L = [
      arr_left[0] + 1,
      arr_left[1] + 1,
      arr_left[2] + 1,
      arr_left[3] + 1,
      arr_left[4] + 1,
      arr_left[5] + 1,
    ];
    // console.log("left " + j);
  }

  function drawtext_l_incentive(l) {
    var ctx = l.getContext("2d");
    var text = j;
    ctx.font = "36px Times New Roman, sans-serif";
    ctx.textAlign = "center";
    ctx.fillStyle = "white";
    ctx.fillText("   " + j, 140, 100);
  }
  function drawtext_r_incentive(r) {
    var ctx = r.getContext("2d");
    ctx.font = "36px Times New Roman, sans-serif";
    ctx.textAlign = "center";
    ctx.fillStyle = "white";
    ctx.fillText("   " + w, 140, 100);
  }



  function drawtext_l_fixed_prac(l) {
    var ctx = l.getContext("2d");
    var text = j;
    ctx.font = "36px Times New Roman, sans-serif";
    ctx.textAlign = "center";
    ctx.fillStyle = "white";
    tmp = 0
    if (j > w) {
      tmp = acc_reward
    }
    ctx.fillText("  " + tmp + " points", 140, 100);
  }
  function drawtext_r_fixed_prac(r) {
    var ctx = r.getContext("2d");
    ctx.font = "36px Times New Roman, sans-serif";
    ctx.textAlign = "center";
    ctx.fillStyle = "white";
    tmp2 = 0
    if (w > j) {
      tmp2 = acc_reward
    }
    ctx.fillText("  " + tmp2 + " points", 140, 100);
  }


  function drawtext_l_incentive_prac(l) {
    var ctx = l.getContext("2d");
    var text = j;
    ctx.font = "36px Times New Roman, sans-serif";
    ctx.textAlign = "center";
    ctx.fillStyle = "white";
    tmp = 0
    ctx.fillText("  " + j + " points", 140, 100);
  }
  function drawtext_r_incentive_prac(r) {
    var ctx = r.getContext("2d");
    ctx.font = "36px Times New Roman, sans-serif";
    ctx.textAlign = "center";
    ctx.fillStyle = "white";
    tmp2 = 0
    ctx.fillText("  " + w + " points", 140, 100);
  }

  var fixedvalleft = 0;

  function drawRectR(d, arr_right) {
    w = 0;

    var ctx = d.getContext("2d");
    ctx.beginPath();

    // var g = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[g];
    ctx.fillStyle = col1[arr_right[0]];
    ctx.fillRect(0, 0, 100, 100);

    // var h = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[h];
    ctx.fillStyle = col1[arr_right[1]];
    ctx.fillRect(125, 0, 100, 100);

    // var i = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[i];
    ctx.fillStyle = col1[arr_right[2]];
    ctx.fillRect(250, 0, 100, 100);

    // var j = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[j];
    ctx.fillStyle = col1[arr_right[3]];
    ctx.fillRect(0, 125, 100, 100);

    // var k = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[k];
    ctx.fillStyle = col1[arr_right[4]];
    ctx.fillRect(125, 125, 100, 100);

    // var l = Math.floor(Math.random()*8);
    // ctx.fillStyle = col1[l];
    ctx.fillStyle = col1[arr_right[5]];
    ctx.fillRect(250, 125, 100, 100);

    for (var z = 0; z < arr_right.length; ++z) {
      w += arr_right[z] + 1;
      // arr_right[z] = arr_right[z]+1
    }
    arr_R = [
      arr_right[0] + 1,
      arr_right[1] + 1,
      arr_right[2] + 1,
      arr_right[3] + 1,
      arr_right[4] + 1,
      arr_right[5] + 1,
    ];
    // console.log("right :" + w)
  }

  function coverWhite(wh) {
    var ctx = wh.getContext("2d");
    ctx.beginPath();
    var a = Math.floor(Math.random() * 8);
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, 200, 200);
  }


  var payment_trial = {
    type: "survey-text",
    preamble: `<p>In order for you to be compensated, we will need your PayPal or Venmo account information.</p>
                <p>If you do not wish to provide us with this information, or do not have an account, you may exit the experiment by hitting the ESC key.</p>`,
    questions: [
      { prompt: "PayPal/Venmo account", name: "payment_account" },
    ],
  };
  timeline.push(payment_trial);
  timeline.push(cursor_off);


  var instr2 = {
    type: "html-keyboard-response",
    stimulus: `<p>Today, your task will be to make a series of choices between two colorful objects. </p>
            <p>To see an example object, press the SPACE BAR. </p>`,
    choices: ["space"],
  };

  var instr3 = {
    type: "image-keyboard-response",
    stimulus: ["img/exampleobj/exampleobj.png"],
    stimulus_height: 300,
    stimulus_width: 450,
    prompt: "<p>Press the SPACE BAR to continue</p>",
    choices: ["space"],
  };

  // var instr4 = {
  //   type: "html-keyboard-response",
  //   stimulus:
  //     `<p>Over ` +
  //     rep +
  //     ` rounds, you will be choosing the better of two objects. The value of each object is</p>
  //         <p>simply the sum of the values of each colored block in the object. The colored blocks are</p>
  //         <p>each worth a different amount of points, and each color is equally likely to appear. In</p>
  //         <p>this task, each point is worth $` + Number(1 / conversion_rate).toFixed(2) + `. In order to know the value of an object, you will</p>
  //         <p>first need to learn what each color is worth.</p>
  //         <p>Press the SPACE BAR to continue. </p>`,
  //   choices: ["space"],
  // };


  if (fixedfirst) {
    var instr4 = {
      type: "html-keyboard-response",
      stimulus:
        `<p>Over ` +
        rep +
        ` rounds, you will be choosing the better of two objects. The value of each object is</p>
            <p>simply the sum of the values of each colored block in the object. The colored blocks are</p>
            <p>each worth a different amount of points, and each color is equally likely to appear. In</p>
            <p>this task, you will receive one dollar for every ` + conversion_rate + ` points. In order to know the value</p>
            <p>of an object, you will first need to learn what each color is worth.</p>
            <p>Press the SPACE BAR to continue. </p>`,
      choices: ["space"],
    };
  }
  if (fixedfirst == false) {
    var instr4 = {
      type: "html-keyboard-response",
      stimulus:
        `<p>Over ` +
        rep +
        ` rounds, you will be choosing the better of two objects. The value of each object is</p>
            <p>simply the sum of the values of each colored block in the object. The colored blocks are</p>
            <p>each worth a different amount of points, and each color is equally likely to appear. In</p>
            <p>this task, you will receive one dollar for every `+ conversion_rate + ` points. In order to know the value</p>
            <p>of an object, you will first need to learn what each color is worth.</p>
            <p>Press the SPACE BAR to continue. </p>`,
      choices: ["space"],
    };
  }

  var instr5acc = {
    type: "html-keyboard-response",
    stimulus:
      `<p>Each round, you will see two objects on the screen. All objects will have positive values and</p>
       <p>you will gain a bonus for choosing the better of the two options. In other words, you will gain</p>
       <p>` + acc_reward + ` points for every trial where you choose the better option and 0 points for every trial</p>
       <p>where you choose the worse option. Every ` + num_curr_score + ` trials, we will tell you your current score.</p>
       <p>Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };

  var instr5val = {
    type: "html-keyboard-response",
    stimulus:
    `<p>Each round, you will see two objects on the screen. All objects will have positive values and</p>
       <p>you will gain a bonus equal to the value of whichever object you choose. In other words, you will</p>
       <p>gain the point value of the option you select whether or not it is the better option.</p>
       <p>Every ` + num_curr_score + ` trials, we will tell you your current score.</p>
       <p>Press the SPACE BAR to continue.</p>`,

    choices: ["space"],
  };

  var instr6 = {
    type: "html-keyboard-response",
    stimulus: `<p>The following screen will display the colors you will see throughout this task.</p>
            <p>Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };


  // var show_rainbow = {
  //   type: "rainbow",
  //   rainbow_parameter: rainbow,
  //   rainbow_values_parameter: rainbow_values,
  //   text_parameter: rainbow_text,
  //   choices: ["space"],
  // };

  var instrfixed = {
    type: "html-keyboard-response",
    stimulus:
      `
        <p></p>
        <p>Remember, in this experiment, you will receive an <b>accuracy-based reward</b></p>
        <p>for choosing the option that has a higher total value. This means that you will receive ` +
      acc_reward + ` </p>
        <p>points for selecting the better option, and zero points for selecting the worse option.</p>
        <p>The next screen will show an example. Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };


  // var instrfixed_2 = {
  //   type: "html-keyboard-response",
  //   stimulus:
  //     `<p>In this trial, the object on the left has a higher total value than the object on the right.</p>
  //      <p>Selecting the better object (higher value) will give you ` + acc_reward + ` points.</p>
  //      <p>Selecting the worse object (lower value) will give you  0 points. </p>
  //      <p>Press the SPACE BAR to continue.</p>`,
  //   choices: ["space"],
  // };

  var instrincentive = {
    type: "html-keyboard-response",
    stimulus: `
        <p>Remember, in this experiment, you will receive a <b>value-based reward</b> for your
        <p>choices. This means that you will receive the point value of the option you select,</p>
        <p>whether or not it is the better option.</p>
        <p>The next screen will show an example. Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };

  // var instrincentive_2 = {
  //   type: "html-keyboard-response",
  //   stimulus: `<p>In the following rounds, the object on the left has a higher total value than the</p>
  //     <p>object on the right. Since you will receive the point value of the option you select, in</p>
  //     <p>this example you would receive XXX points for choosing the option on the left, and XXX</p>
  //     <p>points for choosing the option on the right.</p>
  //     <p>Press the SPACE BAR to continue.</p>`,
  //   choices: ["space"],
  // };

  var instr_start_training = {
    type: "html-keyboard-response",
    stimulus: `<p>You will now begin the training.</p>
            <p>An object made up of six random colored blocks will appear on the left, and another object made up</p>
            <p>of six random colored blocks will appear on the right. Select the side that you think is worth more</p>
            <p>points. Press <b>F</b> to select left, and press <b>J</b> to select right. When you are ready, rest</p>
            <p>your fingers on the <b>F</b> and <b>J</b> keys.</p>
            <p>Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };

  var instr_start_training_2 = {
    type: "html-keyboard-response",
    stimulus: `<p>You will now begin the training.</p>
            <p>When you are ready, rest your fingers on the <b>F</b> and <b>J</b> keys.</p>
            <p>Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };

var pass_training_FR_1 = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      var tmp_sum = 0;
      // console.log(accuracy);
      cu_sco = f(fixed_FR, 1)
      trial.stimulus =
      `<p>You are now ready to begin the experiment.</p>
      <p> In this training round, you scored ` + cu_sco + ` points.</p> \
      <p> Remember, your bonus payment will depend on your choices in this section. </p>
      <p>If you choose the better option, you will receive ` +
      acc_reward + ` points.</p>
        <p>When you are ready, rest your fingers on the <b>F</b> and <b>J</b> keys.</p>
        <p>Press the SPACE BAR to start the experiment.</p>`;
    },
    on_finish: function () {
    }
  };


  var pass_training_FR_2 = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      var tmp_sum = 0;
      cu_sco = f(fixed2_FR, 1)
      trial.stimulus =
      `<p>You are now ready to begin the experiment.</p>
      <p> In this training round, you scored ` + cu_sco + ` points.</p> \
      <p> Remember, your bonus payment will depend on your choices in this section. </p>
      <p>If you choose the better option, you will receive ` +
      acc_reward + ` points.</p>
        <p>When you are ready, rest your fingers on the <b>F</b> and <b>J</b> keys.</p>
        <p>Press the SPACE BAR to start the experiment.</p>`;
    },
    on_finish: function () {
    }
  };

  var pass_training_FR_3 = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      var tmp_sum = 0;
      cu_sco = f(fixed3_FR, 1)
      trial.stimulus =
      `<p>You are now ready to begin the experiment.</p>
      <p> In this training round, you scored ` + cu_sco + ` points.</p> \
      <p> Remember, your bonus payment will depend on your choices in this section. </p>
      <p>If you choose the better option, you will receive ` +
      acc_reward + ` points.</p>
        <p>When you are ready, rest your fingers on the <b>F</b> and <b>J</b> keys.</p>
        <p>Press the SPACE BAR to start the experiment.</p>`;
    },
    on_finish: function () {
    }
  };

var pass_training_VB_1 = {
  type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      var tmp_sum = 0;
      cu_sco = h(training_values_VB_1)
      trial.stimulus =
      `<p>You are now ready to begin the experiment. </p>
      <p>In this training round, you scored ` + cu_sco + ` points.</p>
      <p>Remember, your bonus payment will depend on your choices in this section. </p>
          <p>You will get points for whichever option you choose.</p>
          <p>When you are ready, rest your fingers on the <b>F</b> and <b>J</b> keys.</p>
          <p>Press the SPACE BAR to start the experiment.</p>`;
    },
    on_finish: function () {
    }
  };
  
  var pass_training_VB_2 = {
  type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      var tmp_sum = 0;
      cu_sco = h(training_values_VB_2)
      trial.stimulus =
      `<p>You are now ready to begin the experiment. </p>
      <p>In this training round, you scored ` + cu_sco + ` points.</p>
      <p>Remember, your bonus payment will depend</p>
          <p>on your choices in this section. You will get points for whichever option you choose.</p>
          <p>When you are ready, rest your fingers on the <b>F</b> and <b>J</b> keys.</p>
          <p>Press the SPACE BAR to start the experiment.</p>`;
    },
    on_finish: function () {
    }
  };

  var pass_training_VB_3 = {
  type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      var tmp_sum = 0;
      cu_sco = h(training_values_VB_3)
      trial.stimulus =
      `<p>You are now ready to begin the experiment. </p>
      <p>In this training round, you scored ` + cu_sco + ` points.</p>
      <p>Remember, your bonus payment will depend</p>
          <p>on your choices in this section. You will get points for whichever option you choose.</p>
          <p>When you are ready, rest your fingers on the <b>F</b> and <b>J</b> keys.</p>
          <p>Press the SPACE BAR to start the experiment.</p>`;
    },
    on_finish: function () {
    }
  };


  var fail_training_1_VB = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      var tmp_sum = 0;
      cu_sco = h(training_values_VB_1)
      trial.stimulus =
        `<p> Whoops! Looks like you made a couple of mistakes. Let's try that again. </p> \
             <p>In this training round, you scored ` + cu_sco + ` points.</p> \
        <p>Please remember to select the object with the higher value sum.</p>
        <p>Press <b>F</b> to select left, and press <b>J</b> to select right.</p>
        <p>When you are ready, press the SPACE BAR to try the training again.</p>
        `;
    },
    on_finish: function () {
    }
  };

  var fail_training_1_FR = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      cu_sco = f(fixed_FR, 1)
      trial.stimulus =
        `<p> Whoops! Looks like you made a couple of mistakes. Let's try that again. </p> \
             <p>In this training round, you scored ` + cu_sco + ` points.</p> \
        <p>Please remember to select the object with the higher value sum.</p>
        <p>Press <b>F</b> to select left, and press <b>J</b> to select right.</p>
        <p>When you are ready, press the SPACE BAR to try the training again.</p>
        `;
    },
    on_finish: function () {
    }
  };


  var fail_training_2_VB = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      cu_sco = h(training_values_VB_2)
      trial.stimulus =
        `<p> Whoops! Looks like you made a couple of mistakes. Let's try that again. </p> \
             <p>In this training round, you scored ` + cu_sco + ` points.</p> \
        <p>Please remember to select the object with the higher value sum.</p>
        <p>Press <b>F</b> to select left, and press <b>J</b> to select right.</p>
        <p>When you are ready, press the SPACE BAR to try the training again.</p>
        `;
    },
    on_finish: function () {
    }
  };

  var fail_training_2_FR = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      cu_sco = f(fixed2_FR, 1)
      trial.stimulus =
        `<p> Whoops! Looks like you made a couple of mistakes. Let's try that again. </p> \
             <p>In this training round, you scored ` + cu_sco + ` points.</p> \
        <p>Please remember to select the object with the higher value sum.</p>
        <p>Press <b>F</b> to select left, and press <b>J</b> to select right.</p>
        <p>When you are ready, press the SPACE BAR to try the training again.</p>
        `;
    },
    on_finish: function () {
    }
  };


  var fail_training_3_VB = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      cu_sco = h(training_values_VB_3)
      trial.stimulus =
        `<p> Whoops! Looks like you made a couple of mistakes.</p> \
        <p>In this training round, you scored ` + cu_sco + ` points.</p> \
        <p>Please try your best in the next part of the experiment.</p>
        <p></p>
        <p>Please press space to continue.</p>
        `;
    },
    on_finish: function () {
    }
  };

  var fail_training_3_FR = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      cu_sco = f(fixed3_FR, 1)
      trial.stimulus =
        `<p> Whoops! Looks like you made a couple of mistakes.</p> \
        <p>In this training round, you scored ` + cu_sco + ` points.</p> \
        <p>Please try your best in the next part of the experiment.</p>
        <p></p>
        <p>Please press space to continue.</p>
        `;
    },
    on_finish: function () {
    }
  };









  var acc_VB = [];
  var acc2_VB = [];
  var acc3_VB = [];

  var acc_FR = [];
  var acc2_FR = [];
  var acc3_FR = [];
  var fixed_FR = [];
  var fixed2_FR = [];
  var fixed3_FR = [];
  var training_values_VB_1 = [0];
  var training_values_VB_2 = [0];
  var training_values_VB_3 = [0];
  var idx = 0;
  var idx2 = 0;
  var idx3 = 0;

  //VB
  var trial_training = {
    type: "blocks",
    stimulus_L: drawRectL,
    stimulus_R: drawRectR,
    text_l: drawtext_l_incentive,
    text_r: drawtext_r_incentive,
    coverWhite_f: coverWhite,
    choices: ["f", "j"],
    on_finish: function (data) {
      data.task = "training_VB";
      if (j == w) {
        data.accuracy = 1;
        training_values_VB_1.push(j)
      }
      if (j > w) {
        //if left is greater than right
        if (data.key_press == 70) {
          data.accuracy = 1;
          training_values_VB_1.push(j)
        } else {
          data.accuracy = 0;
          training_values_VB_1.push(w)
        }
      }
      if (w > j) {
        if (data.key_press == 74) {
          data.accuracy = 1;
          training_values_VB_1.push(w);
        } else {
          data.accuracy = 0;
          training_values_VB_1.push(j)
        }
      }
      acc_VB[idx] = data.accuracy;
      data.Left_sum = j;
      data.Right_sum = w;
      data.arr_L = arr_L;
      data.arr_R = arr_R;
      // data.accuracy = acc_VB[idx];
      idx++;
      data.trialN = idx;
      // trial_count++;
    },
    //data: {shape: 'rectangle'}
  };
  var node_VB = {
    timeline: [fixation, trial_training],
    repetitions: n,
  };

  //Test 2
  var trial_training2 = {
    type: "blocks",
    stimulus_L: drawRectL,
    stimulus_R: drawRectR,
    text_l: drawtext_l_incentive,
    text_r: drawtext_r_incentive,
    coverWhite_f: coverWhite,
    choices: ["f", "j"],
    on_finish: function (data) {
      data.task = "training_VB";
      if (j == w) {
        data.acc2_VB = 1;
        training_values_VB_2.push(j)
      }
      if (j > w) {
        //if left is greater than right
        if (data.key_press == 70) {
          data.acc2_VB = 1;
          training_values_VB_2.push(j)
        } else {
          data.acc2_VB = 0;
          training_values_VB_2.push(w)
        }
      }
      if (w > j) {
        if (data.key_press == 74) {
          data.acc2_VB = 1;
          training_values_VB_2.push(w)
        } else {
          data.acc2_VB = 0;
          training_values_VB_2.push(j)
        }
      }
      // data.acc2_VB = acc2_VB;
      acc2_VB[idx2] = data.acc2_VB;
      data.Left_sum = j;
      data.Right_sum = w;
      data.arr_L = arr_L;
      data.arr_R = arr_R;
      idx2++;
      data.trialN = idx2;
      // trial_count++;
    },
    //data: {shape: 'rectangle'}
  };
  var node2 = {
    timeline: [fixation, trial_training2],
    repetitions: n,
  };

  //Test 3
  var trial_training3 = {
    type: "blocks",
    stimulus_L: drawRectL,
    stimulus_R: drawRectR,
    text_l: drawtext_l_incentive,
    text_r: drawtext_r_incentive,
    coverWhite_f: coverWhite,
    choices: ["f", "j"],
    on_finish: function (data) {
      data.task = "training_VB";
      if (j == w) {
        data.acc3_VB = 1;
        training_values_VB_3.push(j)
      }
      if (j > w) {
        //if left is greater than right
        if (data.key_press == 70) {
          data.acc3_VB = 1;
          training_values_VB_3.push(j)
        } else {
          data.acc3_VB = 0;
          training_values_VB_3.push(w)
        }
      }
      if (w > j) {
        if (data.key_press == 74) {
          data.acc3_VB = 1;
          training_values_VB_3.push(w)
        } else {
          data.acc3_VB = 0;
          training_values_VB_3.push(j)
        }
      }
      acc3_VB[idx3] = data.acc3_VB;
      data.Left_sum = j;
      data.Right_sum = w;
      data.arr_L = arr_L;
      data.arr_R = arr_R;
      // data.acc3_VB = acc3_VB;
      idx3++;
      data.trialN = idx3;
      // trial_count++;
    },
    //data: {shape: 'rectangle'}
  };
  var node3 = {
    timeline: [fixation, trial_training3],
    repetitions: n,
  };

  //Conditional 1
  var accuracy = 0;
  var conditional_1_value = {
    timeline: [fail_training_1_VB, node2],
    conditional_function: function () {
      accuracy = 0.0;
      var counter = 0;
      for (var i = 0; i < acc_VB.length; i++) {
        if (acc_VB[i] == 1) {
          counter++;
        }
      }
      accuracy = counter / acc_VB.length;
      if (accuracy < 0.7) {
        //change to .70
        return true;
      } else {
        return false
      }
    },
  };

  var conditional_pass_1_VB = {
    timeline: [pass_training_VB_1],
    conditional_function: function() {
      if (accuracy > 0.7){
        return true
      }
    }
  }


  //Conditional 2
  var accuracy2 = 0;
  var conditional_2_value = {
    timeline: [fail_training_2_VB, node3],
    conditional_function: function () {
      accuracy2 = 0.0;
      var counter2 = 0;
      for (var i = 0; i < acc2_VB.length; i++) {
        if (acc2_VB[i] == 1) {
          counter2++;
          // console.log('test')
        }
      }
      accuracy2 = counter2 / acc2_VB.length;
      if (accuracy2 < 0.7) {
        return true;
      } else {
        return false
      }
    },
  };


  var conditional_pass_2_VB = {
    timeline: [pass_training_VB_2],
    conditional_function: function() {
      if (accuracy2 > 0.7){
        return true
      }
    }
  }


  //Conditional 3
  var accuracy3 = 0;
  var conditional_3_value = {
    timeline: [fail_training_3_VB],
    conditional_function: function () {
      accuracy3 = 0.0;
      var counter3 = 0;
      for (var i = 0; i < acc3_VB.length; i++) {
        if (acc3_VB[i] == 1) {
          counter3++;
        }
      }
      accuracy3 = counter3 / acc3_VB.length;
      if (accuracy3 < 0.7) {
        return true;
      } else {
        return false;
      }
    },
  };


  var conditional_pass_3_VB = {
    timeline: [pass_training_VB_3],
    conditional_function: function() {
      if (accuracy3 > 0.7){
        return true
      }
    }
  }



  var reward_val_VB = 0;
  var reward_val_FR;
  var rand_reward = [];
  // var reward_val = 0;
  var left_arr = [];
  var right_arr = [];
  var all_arr = [];
  var randidx;
  acc_exp_FR = [];
  acc_exp_VB = [];
  acc_training_FR = []
  acc_training_VB = []
  var idx4 = 0;
  var left_value = [];
  var right_value = [];
  var valueScore;
  //Experiment
  var experiment_value = {
    type: "blocks-exp",
    stimulus_L: drawRectLexp,
    stimulus_R: drawRectRexp,
    coverWhite_f: coverWhite,
    choices: ["f", "j"],
    on_finish: function (data) {
      data.task = "experiment_VB";
      if (j == w) {
        if (Math.random() > 0.5) {
          data.accuracy = 1;
          left_arr[idx4] = j;
        } else {
          data.accuracy = 0;
          right_arr[idx4] = w;
        }
      }
      if (j > w) {
        //if left is greater than right
        if (data.key_press == 70) {
          data.accuracy = 1;
          left_arr[idx4] = j;
        } else {
          data.accuracy = 0;
          right_arr[idx4] = w;
        }
      }
      if (w > j) {
        if (data.key_press == 74) {
          data.accuracy = 1;
          right_arr[idx4] = w;
        } else {
          data.accuracy = 0;
          left_arr[idx4] = j;
        }
      }
      // acc_exp_VB[idx4] = data.correct;
      // data.experiment_VB_accuracy = acc_exp_VB[idx4];
      data.trialN = trial_count;
      left_value[idx4] = j;
      data.Left_sum = j;
      right_value[idx4] = w;
      data.Right_sum = w;
      // data.l_topleft = a
      // data.l_topmiddle = b
      // data.l_topright = c
      // data.l_bottomleft = d
      // data.l_bottommiddle = e
      // data.l_bottomright = f

      // data.r_topleft = g
      // data.r_topmiddle = h
      // data.r_topright = i
      // data.r_bottomleft = j
      // data.r_bottommiddle = k
      // data.r_bottomright = l
      data.arr_L = arr_L;
      data.arr_R = arr_R;
      idx4++;
      data.trialN = idx4;
      // trial_count++;
      left_arr.filter(Number);
      right_arr.filter(Number);
      all_arr = left_arr.concat(right_arr);
      // data.experiment_selections_VB = all_arr[idx4]
    },
  };

  var experiment_node_value = {
    timeline: [fixation, experiment_value],
    repetitions: 1,
  };

  var acc_points = 0;
  var fixed_points = 0;
  var value_points = 0;

  var ordermemtask;
  var testset;
  var testsetchoice;
  var checkOrder = function () {
  
    if (col1 == colors) {
      //PB
      if (pinktoblue) {
        ordermemtask = pinktoblue;
        // console.log("pinktoblue");
        testset = PB;
        testsetchoice = PB_choice;
        // example_current = example_PB
      }
      if (bluetopink) {
        ordermemtask = bluetopink;
        // console.log("bluetopink");
        testset = PB;
        testsetchoice = PB_choice;
        // example_current = example_BP
      }
    }
    if (col1 == colors2) {
      if (orangetogreen) {
        ordermemtask = orangetogreen;
        // ("orangetogreen");
        testset = OG;
        testsetchoice = OG_choice;
        // example_current = example_GO
      }
      if (greentoorange) {
        ordermemtask = greentoorange;
        //("greentoorange");
        testset = OG;
        testsetchoice = OG_choice;
        // example_current = example_OG
      }
    }
    shuffle(testset);
    shuffle(testsetchoice);

    for (var i = 0; i < testsetchoice.length; i++) {
      if (Math.random() > 0.5) {
        testsetchoice[i].value = Math.floor(
          Math.random() * (48 - 6 + 1) + 6
        ).toString();
      }
    }
  };
  var checkOrdercall = {
    type: "call-function",
    func: checkOrder,
  };

  var OG = [
    "img/OG/21.jpg",
    "img/OG/24.jpg",
    "img/OG/27.jpg",
    "img/OG/29.jpg",
    "img/OG/35.jpg",
  ];

  var PB = [
    "img/PB/21.jpg",
    "img/PB/24.jpg",
    "img/PB/27.jpg",
    "img/PB/29.jpg",
    "img/PB/35.jpg",
  ];

  var OG_choice = [
    { stim: "img/OG/21.jpg", value: "21" },
    { stim: "img/OG/24.jpg", value: "24" },
    { stim: "img/OG/27.jpg", value: "27" },
    { stim: "img/OG/29.jpg", value: "29" },
    { stim: "img/OG/35.jpg", value: "35" },
  ];

  // choice: make F and J, change instructions
  var PB_choice = [
    { stim: "img/PB/21.jpg", value: "21" },
    { stim: "img/PB/24.jpg", value: "24" },
    { stim: "img/PB/27.jpg", value: "27" },
    { stim: "img/PB/29.jpg", value: "29" },
    { stim: "img/PB/35.jpg", value: "35" },
  ];


  var example_current = [0, 0]
  var example_current_2 = [0, 0];

  var example_PB = ["img/examples/PB.jpg", "right", "25", "35"]
  //left 25, right 35

  var example_BP = ["img/examples/BP.jpg", "right", "13", "33"]
  //left 13, right 33


  var example_GO = ["img/examples/GO.jpg", "right", "19", "33"]
  //left 19, right 33


  var example_OG = ["img/examples/OG.jpg", "right", "29", "34"]
  //left 29, right 34



  var finish_p1_fixed_done = {
    type: "html-keyboard-response",
    stimulus: `<p>You have completed the first half of the experiment.</p>
            <p>Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };

  var finish_p1_value_done = {
    type: "html-keyboard-response",
    stimulus: `<p>You have completed the first half of the experiment.</p>
            <p>Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };

  //Make the color spectrum different
  // var myfunc = function () {
  //   if (col1 == colors) {
  //     col1 = colors2;
  //     anchors = anchors_two
  //   } else {
  //     col1 = colors;
  //     anchors = anchors_two
  //   }

  //   if (arrays == arrays1) {
  //     arrays = arrays2;
  //   } else {
  //     arrays = arrays1;
  //   }

  //   indexx = 0;
  //   indexx2 = 0;
  // };
  // var trialm = {
  //   type: "call-function",
  //   func: myfunc,
  // };

  var idx5 = 0;


  var trial_practice_fixed = {
    type: "blocks-prac-fixed",
    stimulus_L: drawRectL,
    stimulus_R: drawRectR,
    text_l: drawtext_l_fixed_prac,
    text_r: drawtext_r_fixed_prac,
    coverWhite_f: coverWhite,
    choices: ["f", "j"]
  };
  var node_prac_fixed = {
    timeline: [fixation, trial_practice_fixed],
    repetitions: z,
  };


  var trial_practice_VB = {
    type: "blocks-prac-VB",
    stimulus_L: drawRectL,
    stimulus_R: drawRectR,
    text_l: drawtext_l_incentive_prac,
    text_r: drawtext_r_incentive_prac,
    coverWhite_f: coverWhite,
    choices: ["f", "j"]
  };
  var node_prac_VB = {
    timeline: [fixation, trial_practice_VB],
    repetitions: z,
  };



  if (training_fixed_static == false) {
    var trial_training_fixed = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_incentive,
      text_r: drawtext_r_incentive,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_FR";
        if (j == w) {
          data.accuracy = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        fixed_FR[idx5] = data.accuracy;
        // data.fixed_FR = fixed_FR[idx5];
        data.Left_sum = j;
        data.Right_sum = w;
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        idx5++;
        data.trialN = idx5;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node_fixed = {
      timeline: [fixation, trial_training_fixed],
      repetitions: n,
    };
  }

  if (training_fixed_static == true) {
    var trial_training_fixed = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_fixed_prac,
      text_r: drawtext_r_fixed_prac,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_FR";
        if (j == w) {
          data.accuracy = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        fixed_FR[idx5] = data.accuracy;
        // data.fixed_FR = fixed_FR[idx5];
        data.Left_sum = j;
        data.Right_sum = w;
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        idx5++;
        data.trialN = idx5;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node_fixed = {
      timeline: [fixation, trial_training_fixed],
      repetitions: n,
    };
  }














  var idx6 = 0;





  //Test 2
  if (training_fixed_static == false) {
    var trial_training2_fixed = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_incentive,
      text_r: drawtext_r_incentive,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_FR";
        if (j == w) {
          data.training_FR_accuracy_2 = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.training_FR_accuracy_2 = 1;
          } else {
            data.training_FR_accuracy_2 = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.training_FR_accuracy_2 = 1;
          } else {
            data.training_FR_accuracy_2 = 0;
          }
        }
        fixed2_FR[idx6] = data.training_FR_accuracy_2;
        data.FR_left_sum = j;
        data.FR_right_sum = w;
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        // data.fixed2_FR = fixed2_FR;
        idx6++;
        data.trialN = idx6;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node2_fixed = {
      timeline: [fixation, trial_training2_fixed],
      repetitions: n,
    };
  }
  if (training_fixed_static == true) {
    var trial_training2_fixed = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_fixed_prac,
      text_r: drawtext_r_fixed_prac,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_FR";
        if (j == w) {
          data.training_FR_accuracy_2 = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.training_FR_accuracy_2 = 1;
          } else {
            data.training_FR_accuracy_2 = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.training_FR_accuracy_2 = 1;
          } else {
            data.training_FR_accuracy_2 = 0;
          }
        }
        fixed2_FR[idx6] = data.training_FR_accuracy_2;
        data.FR_left_sum = j;
        data.FR_right_sum = w;
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        // data.fixed2_FR = fixed2_FR;
        idx6++;
        data.trialN = idx6;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node2_fixed = {
      timeline: [fixation, trial_training2_fixed],
      repetitions: n,
    };
  }





  var idx7 = 0;

  //Test 3
  if (training_fixed_static == false) {
    var trial_training3_fixed = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_incentive,
      text_r: drawtext_r_incentive,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_FR";
        if (j == w) {
          data.training_FR_accuracy_3 = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.training_FR_accuracy_3 = 1;
          } else {
            data.training_FR_accuracy_3 = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.training_FR_accuracy_3 = 1;
          } else {
            data.training_FR_accuracy_3 = 0;
          }
        }
        fixed3_FR[idx7] = data.training_FR_accuracy_3;
        data.acc_FR = data.training_FR_accuracy_3[idx7];
        data.FR_left_sum = j;
        data.FR_right_sum = w;
        idx7++;
        data.trialN = idx7;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node3_fixed = {
      timeline: [fixation, trial_training3_fixed],
      repetitions: n,
    };
  }
  if (training_fixed_static == true) {
    var trial_training3_fixed = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_fixed_prac,
      text_r: drawtext_r_fixed_prac,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_FR";
        if (j == w) {
          data.training_FR_accuracy_3 = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.training_FR_accuracy_3 = 1;
          } else {
            data.training_FR_accuracy_3 = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.training_FR_accuracy_3 = 1;
          } else {
            data.training_FR_accuracy_3 = 0;
          }
        }
        fixed3_FR[idx7] = data.training_FR_accuracy_3;
        data.acc_FR = data.training_FR_accuracy_3[idx7];
        data.FR_left_sum = j;
        data.FR_right_sum = w;
        idx7++;
        data.trialN = idx7;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node3_fixed = {
      timeline: [fixation, trial_training3_fixed],
      repetitions: n,
    };
  }






  var pass_FR;





  //Conditional 1
  var accuracy = 0;
  var conditional_1_fixed = {
    timeline: [fail_training_1_FR, node2_fixed],
    conditional_function: function () {
      accuracy = 0.0;
      var counter = 0;
      for (var i = 0; i < fixed_FR.length; i++) {
        if (fixed_FR[i] == 1) {
          counter++;
        }
      }
      accuracy = counter / fixed_FR.length;
      if (accuracy < 0.7) {
        return true;
      } else {
        return false;
      }
    },
  };

  //Conditional 2
  var accuracy2 = 0;
  var conditional_2_fixed = {
    timeline: [fail_training_2_FR, node3_fixed],
    conditional_function: function () {
      var counter2 = 0;
      for (var i = 0; i < fixed2_FR.length; i++) {
        if (fixed2_FR[i] == 1) {
          counter2++;
          // console.log('test_fr!')
        }
      }
      accuracy2 = counter2 / fixed2_FR.length;
      if (accuracy2 < 0.7) {
        return true;
      } else {
        return false;
      }
    },
  };


  //Conditional 3
  var accuracy3 = 0;
  var conditional_3_fixed = {
    timeline: [fail_training_3_FR],
    conditional_function: function () {
      var counter3 = 0;
      for (var i = 0; i < fixed3_FR.length; i++) {
        if (fixed3_FR[i] == 1) {
          counter3++;
        }
      }
      accuracy3 = counter3 / fixed3_FR.length;
      if (accuracy3 < 0.7) {
        return true;
      } else {
        return false;
      }
    },
  };






  var conditional_pass_1_fixed = {
    timeline: [pass_training_FR_1],
    conditional_function: function() {
      if (accuracy > 0.7){
        return true
      }
      else {
        return false
      }
    }

  }


  var conditional_pass_2_fixed = {
    timeline: [pass_training_FR_2],
    conditional_function: function() {
      if (accuracy2 > 0.7){
        return true
      }
      else {
        return false
      }
    }
  }



  var conditional_pass_3_fixed = {
    timeline: [pass_training_FR_3],
    conditional_function: function() {
      if (accuracy3 > 0.7){
        return true
      }
      else {
        return false
      }
    }
  }






  var reward_val;
  var rand_reward = [];
  // var reward_val = 0;
  // var left_arr = [];
  // var right_arr = [];
  // var all_arr = [];
  var randidx;
  var idxt = 0;
  var left_fixed = [];
  var right_fixed = [];
  //Experiment
  var experiment_fixed = {
    type: "blocks-exp",
    stimulus_L: drawRectLexp,
    stimulus_R: drawRectRexp,
    coverWhite_f: coverWhite,
    choices: ["f", "j"],
    on_finish: function (data) {
      data.task = "experiment_FR";
      if (j == w) {
        if (Math.random() > 0.5) {
          data.accuracy = 1;
        } else {
          data.accuracy = 0;
        }
      }
      if (j > w) {
        //if left is greater than right
        if (data.key_press == 70) {
          data.accuracy = 1;
        } else {
          data.accuracy = 0;
        }
      }
      if (w > j) {
        if (data.key_press == 74) {
          data.accuracy = 1;
        } else {
          data.accuracy = 0;
        }
      }
      // acc_exp_FR[idx5] = data.correct;
      // data.acc_exp_FR = acc_exp_FR;
      acc_exp_FR[idxt] = data.accuracy;
      data.trialN = trial_count;
      // left_arr[idx5] = j;
      left_fixed[idxt] = j;
      // data.left_FR = left_fixed //change to j for just one
      data.Left_sum = j;
      // right_arr[idx5] = w;
      right_fixed[idxt] = w;
      // data.right_FR = right_fixed //change to w for just one
      data.Right_sum = w;
      // data.l_topleft = a
      // data.l_topmiddle = b
      // data.l_topright = c
      // data.l_bottomleft = d
      // data.l_bottommiddle = e
      // data.l_bottomright = f

      // data.r_topleft = g
      // data.r_topmiddle = h
      // data.r_topright = i
      // data.r_bottomleft = j
      // data.r_bottommiddle = k
      // data.r_bottomright = l
      data.arr_L = arr_L;
      data.arr_R = arr_R;
      idxt++;
      data.trialN = idxt;
      // trial_count++;
      // all_arr = left_arr.concat(right_arr);
    },
    //data: {shape: 'rectangle'}
  };

  var experiment_node_fixed = {
    timeline: [fixation, experiment_fixed],
    repetitions: 1,
  };
  // timeline.push(experiment_node_fixed)

  //Instructions
  if (fixedfirst) {
    var instr_arr = [instr2, instr3, instr4, instr5acc];
  }
  if (fixedfirst == false) {
    var instr_arr = [instr2, instr3, instr4, instr5val];
  }
  timeline = timeline.concat(instr_arr);

  var memslider_instr = {
    type: "html-keyboard-response",
    stimulus: `<p>In the following section, we will show you a few more color objects.</p>
            <p>Each of these objects come from the previous phase that you just completed.</p>
            <p>Use the slider to estimate the value of each object.</p>
            <p>Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };

  var memchoice_instr = {
    type: "html-keyboard-response",
    stimulus: `<p>In the following section, we will show you the same color objects again.</p>
            <p>We will show you a possible value of the object.</p>
            <p>If you believe this value is <b>correct</b>, press <b>F</b>.</p>
            <p>If you believe this value is <b>incorrect</b>, press <b>J</b>.</p>
            <p>Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };

  var memslider = {
    type: "memslider",
    stimulus_height: 542 / 2,
    stimulus_width: 854 / 2,
    stimulus: function () {
      return testset[0];
    },
    min: 6,
    max: 48,
    slider_start: Math.floor(Math.random() * 51),
    slider_number: true,
    require_movement: true,
    anchor_left: function () {
      return anchors[0]
    },
    anchor_right: function () {
      return anchors[1]
    },
    labels: ["6", "48"],
  };

  var memslider2 = {
    type: "memslider",
    stimulus_height: 542 / 2,
    stimulus_width: 854 / 2,
    stimulus: function () {
      return testset[1];
    },
    min: 6,
    max: 48,
    slider_start: Math.floor(Math.random() * 51),
    slider_number: true,
    require_movement: true,
    anchor_left: function () {
      return anchors[0]
    },
    anchor_right: function () {
      return anchors[1]
    },
    labels: ["6", "48"],
  };

  var memslider3 = {
    type: "memslider",
    stimulus_height: 542 / 2,
    stimulus_width: 854 / 2,
    stimulus: function () {
      return testset[2];
    },
    min: 6,
    max: 48,
    slider_start: Math.floor(Math.random() * 51),
    slider_number: true,
    require_movement: true,
    anchor_left: function () {
      return anchors[0]
    },
    anchor_right: function () {
      return anchors[1]
    },
    labels: ["6", "48"],
  };

  var memslider4 = {
    type: "memslider",
    stimulus_height: 542 / 2,
    stimulus_width: 854 / 2,
    stimulus: function () {
      return testset[3];
    },
    min: 6,
    max: 48,
    slider_start: Math.floor(Math.random() * 51),
    slider_number: true,
    require_movement: true,
    anchor_left: function () {
      return anchors[0]
    },
    anchor_right: function () {
      return anchors[1]
    },
    labels: ["6", "48"],
  };

  var memslider5 = {
    type: "memslider",
    stimulus_height: 542 / 2,
    stimulus_width: 854 / 2,
    stimulus: function () {
      return testset[4];
    },
    min: 6,
    max: 48,
    slider_start: Math.floor(Math.random() * 51),
    slider_number: true,
    require_movement: true,
    anchor_left: function () {
      return anchors[0]
    },
    anchor_right: function () {
      return anchors[1]
    },
    labels: ["6", "48"],
  };

  var randomstim2 = "";
  var randomstim2str = "";

  var memchoice = {
    type: "memchoice",
    stimulus_height: 542 / 2,
    stimulus_width: 854 / 2,
    stimulus: function () {
      return testsetchoice[0].stim;
    },
    choices: ["F", "J"],
    prompt: function () {
      return (
        "<p>The value of this object is " +
        testsetchoice[0].value +
        ".</p><p>Press <b>F</b> if you believe this is <b>correct</b>.</p>" +
        "</p>Press <b>J</b> if you believe this is <b>incorrect</b>.</p>"
      );
    },
    on_finish: function (data) {
      data.testvalue = testsetchoice[0].value;
    }
  };

  var memchoice2 = {
    type: "memchoice",
    stimulus_height: 542 / 2,
    stimulus_width: 854 / 2,
    stimulus: function () {
      return testsetchoice[1].stim;
    },
    choices: ["F", "J"],
    prompt: function () {
      return (
        "<p>The value of this object is " +
        testsetchoice[1].value +
        ".</p><p>Press <b>F</b> if you believe this is <b>correct</b>.</p>" +
        "</p>Press <b>J</b> if you believe this is <b>incorrect</b>.</p>"
      );
    },
    on_finish: function (data) {
      data.testvalue = testsetchoice[1].value;
    }
  };

  var memchoice3 = {
    type: "memchoice",
    stimulus_height: 542 / 2,
    stimulus_width: 854 / 2,
    stimulus: function () {
      return testsetchoice[2].stim;
    },
    choices: ["F", "J"],
    prompt: function () {
      return (
        "<p>The value of this object is " +
        testsetchoice[2].value +
        ".</p><p>Press <b>F</b> if you believe this is <b>correct</b>.</p>" +
        "</p>Press <b>J</b> if you believe this is <b>incorrect</b>.</p>"
      );
    },
    on_finish: function (data) {
      data.testvalue = testsetchoice[2].value;
    }
  };

  var memchoice4 = {
    type: "memchoice",
    stimulus_height: 542 / 2,
    stimulus_width: 854 / 2,
    stimulus: function () {
      return testsetchoice[3].stim;
    },
    choices: ["F", "J"],
    prompt: function () {
      return (
        "<p>The value of this object is " +
        testsetchoice[3].value +
        ".</p><p>Press <b>F</b> if you believe this is <b>correct</b>.</p>" +
        "</p>Press <b>J</b> if you believe this is <b>incorrect</b>.</p>"
      );
    },
    on_finish: function (data) {
      data.testvalue = testsetchoice[3].value;
    }
  };

  var memchoice5 = {
    type: "memchoice",
    stimulus_height: 542 / 2,
    stimulus_width: 854 / 2,
    stimulus: function () {
      return testsetchoice[4].stim;
    },
    choices: ["F", "J"],
    prompt: function () {
      return (
        "<p>The value of this object is " +
        testsetchoice[4].value +
        ".</p><p>Press <b>F</b> if you believe this is <b>correct</b>.</p>" +
        "</p>Press <b>J</b> if you believe this is <b>incorrect</b>.</p>"
      );
    },
    on_finish: function (data) {
      data.testvalue = testsetchoice[4].value;
    }
  };



  var instr_example = {
    type: "image-keyboard-response",
    stimulus: function () {
      return example_current[0];
    },
    stimulus_height: 400,
    stimulus_width: 1400,
    //prompt: "<p>In this example, the total value of the left object is " + example_current[2] + " and the total value of the right object is " + example_current[3] + ". Press the SPACE BAR to continue</p>",
    on_start: function (trial) {
      if (fixedfirst) {
        trial.prompt =
          `<p> In this example, the total value of the left object is ` + example_current[2] + `.</p>
          <p>The total of value of the right object is ` + example_current[3] + `.</p>
              <p>Since this is an accuracy-based trial, your reward for choosing the option on the right is ` +
          acc_reward + ` points.</p>
            <p>If you choose the option on the left, your reward will be 0 points.</p>
            <p>Press the SPACE BAR to continue.</p>`;
      } else {
        trial.prompt = `<p> In this example, the total value of the left object is ` + example_current[2] + `.</p>
              <p>The total of value of the right object is ` + example_current[3] + `.</p>
              <p>Since this is a value-based trial, your reward for choosing the option on the right is ` +
          example_current[3] + ` points.</p>
            <p>If you choose the option on the left, your reward will be ` +
          example_current[2] + ` points.</p>  
            <p>Press the SPACE BAR to continue.</p>`;
      }

    },
    choices: ["space"],
  };


  var instr_example_2 = {
    type: "image-keyboard-response",
    stimulus: function () {
      return example_current_2[0];
    },
    stimulus_height: 400,
    stimulus_width: 1400,
    //prompt: "<p>In this example, the total value of the left object is " + example_current[2] + " and the total value of the right object is " + example_current[3] + ". Press the SPACE BAR to continue</p>",
    on_start: function (trial) {
      if (fixedfirst) {
        trial.prompt = `<p> In this example, the total value of the left object is ` + example_current_2[2] + `.</p>
              <p>The total of value of the right object is ` + example_current_2[3] + `.</p>
              <p>Since this is a value-based trial, your reward for choosing the option on the right is ` +
          example_current_2[3] + ` points.</p>
            <p>If you choose the option on the left, your reward will be ` +
          example_current_2[2] + ` points.</p>  
            <p>Press the SPACE BAR to continue.</p>`;
      } else {
        trial.prompt = `<p> In this example, the total value of the left object is ` + example_current_2[2] + `.</p>
              <p>The total of value of the right object is ` + example_current_2[3] + `.</p>
              <p>Since this is an accuracy-based trial, your reward for choosing the correct answer is ` +
          acc_reward + ` points.</p>
            <p>Choosing the wrong answer would give you 0 points.</p>
            <p>Press the SPACE BAR to continue.</p>`;
      }

    },
    choices: ["space"],
  };



  var show_rainbow_one = {
    type: "rainbowimage-keyboard-response",
    stimulus: function () {
      return rainbow_one[0];
    },
    stimulus_height: 100,
    stimulus_width: 1000,
    on_start: function (trial) {
      trial.prompt =
        `<p> The values of the colors increase across the spectrum, from ` + rainbow_one[1] + ` to ` + rainbow_one[2] + `.</p>
          <p> Press the SPACE BAR to continue.</p> `
    },
    choices: ["space"],
  };



  var show_rainbow_two = {
    type: "rainbowimage-keyboard-response",
    stimulus: function () {
      return rainbow_two[0];
    },
    stimulus_height: 100,
    stimulus_width: 1000,
    on_start: function (trial) {
      trial.prompt =
        `<p> The values of the colors increase across the spectrum, from ` + rainbow_two[1] + ` to ` + rainbow_two[2] + `.</p>
          <p> Press the SPACE BAR to continue.</p> `
    },
    choices: ["space"],
  };


  var instr_prac = {
    type: "html-keyboard-response",
    stimulus: `<p>Let's try a few final practice trials.</p>
            <p>Select the better of the two options, and we will show you how many points you are awarded for your choice.</p>
            <p>When you are ready, rest your fingers on the <b>F</b> and <b>J</b> keys.</p>
            <p>Press the SPACE BAR to continue.</p>`,
    choices: ["space"],
  };



  var curr_score_FR = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      cu_sco = f(acc_exp_FR, 1)
      trial.stimulus =
        `<p> You have completed ` + (acc_exp_FR.length / rep) * 100 + `% of the experiment. </p> \
             <p>You have currently scored ` + cu_sco + ` points.</p> \
             <p>At a conversion rate of $1 for every ` + conversion_rate + ` points, your current bonus is $` +
        Number((cu_sco / conversion_rate)).toFixed(2) +
        `.</p><p>Press the SPACE BAR to continue.</p>`;
    },
    on_finish: function () {
      // jsPsych.data.addProperties({
      //     compensation: Number((reward_val_VB/conversion_rate)).toFixed(2),
      //     });
    }
  };


  var curr_score_VB = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      cu_sco = g(left_arr, right_arr)
      trial.stimulus =
        `<p> You have completed ` + (left_value.length / rep) * 100 + `% of the experiment. </p> \
             <p>You have currently scored ` + cu_sco + ` points.</p> \
             <p>At a conversion rate of $1 for every ` + conversion_rate + ` points, your current bonus is $` +
        Number((cu_sco / conversion_rate)).toFixed(2) +
        `.</p><p>Press the SPACE BAR to continue.</p>`;
    },
    on_finish: function () {
      // jsPsych.data.addProperties({
      //     compensation: Number((reward_val_VB/conversion_rate)).toFixed(2),
      //     });
    }
  };
  function f(array, value) {
    var n = 0;
    for (i = 0; i < array.length; i++) {
      if (array[i] == value) { n++ }
    }
    return n * acc_reward;
  }


  function g(array1, array2) {
    sum1 = 0
    for (var i = 0; i < array1.length; i++) {
      if (array1[i] > -1) {
        sum1 += array1[i]
      }
    }

    sum2 = 0
    for (var i = 0; i < array2.length; i++) {
      if (array2[i] > -1) {
        sum2 += array2[i]
      }
    }

    return (sum1 + sum2)

  }


  function h(arr) {
    tmp = 0
    for (var i = 0; i < arr.length; i++) {
      tmp += arr[i]
    }
    return tmp;
  }


  curr_exp_idx = 0

  curr_exp_idx2 = 0

  if (fixedfirst == true) {
    timeline.push(instr6);
    timeline.push(show_rainbow_one);
    timeline.push(instr_start_training);
    timeline.push(node_fixed);
    timeline.push(conditional_1_fixed); //if accuracy < .7, show failure and then go to 2nd training
    timeline.push(conditional_pass_1_fixed); //if accuracy > .7, goes to success screen
    timeline.push(conditional_2_fixed);
    timeline.push(conditional_pass_2_fixed);
    timeline.push(conditional_3_fixed);
    timeline.push(conditional_pass_3_fixed);
    timeline.push(instrfixed);
    timeline.push(instr_example)
    timeline.push(instr_prac);
    timeline.push(node_prac_fixed)
    // timeline.push(pass_training_FR);
    for (var i = 0; i < rep; i++) {
      timeline.push(experiment_node_fixed);
      curr_exp_idx++
      if (curr_exp_idx % num_curr_score == 0 & curr_exp_idx != rep) {
        timeline.push(curr_score_FR)
      }
    }
    timeline.push(checkOrdercall);
  } else {
    timeline.push(instr6);
    timeline.push(show_rainbow_one);
    timeline.push(instr_start_training_2);
    timeline.push(node_VB);
    timeline.push(conditional_1_value);
    timeline.push(conditional_pass_1_VB);
    timeline.push(conditional_2_value);
    timeline.push(conditional_pass_2_VB);
    timeline.push(conditional_3_value);
    timeline.push(conditional_pass_3_VB);
    timeline.push(instrincentive);
    timeline.push(instr_example)
    timeline.push(instr_prac);
    timeline.push(node_prac_VB)
    // timeline.push(pass_training_VB);
    for (var i = 0; i < rep; i++) {
      timeline.push(experiment_node_value);
      curr_exp_idx2++
      if (curr_exp_idx2 % num_curr_score == 0 & curr_exp_idx2 != rep) {
        timeline.push(curr_score_VB)
      }
    }
    timeline.push(checkOrdercall);
  }
  var final_reward_value;


  var finished_exp = {
    type: "html-keyboard-response",
    stimulus: `<p>Congratulations - you have completed the experiment!</p>
            <p>Press the SPACE BAR to see your reward.</p>`,
    choices: ["space"],
  };

  timeline.push(finished_exp);

  var reward_fixedfirst = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      trial.stimulus =
        `<p>You earned a total of ` + f(acc_exp_FR, 1) + ` points!</p>
            <p>At a conversion rate of $1 for every ` + conversion_rate + ` points, you will receive a total of $` +
        Number(((f(acc_exp_FR, 1)) / conversion_rate)).toFixed(2) +
        `.</p><p>Press the SPACE BAR to continue.</p>`;
    },
    on_finish: function () {
      jsPsych.data.addProperties({
        compensation: Number(((f(acc_exp_FR, 1)) / conversion_rate)).toFixed(2),
      });
    }
  };

  var reward_valuefirst = {
    type: "html-keyboard-response",
    choices: ["space"],
    on_start: function (trial) {
      trial.stimulus =
        `<p>You earned a total of ` + g(left_arr, right_arr) + ` points!</p>
            <p>At a conversion rate of $1 for every ` + conversion_rate + ` points, you will receive a bonus of $` +
        Number(((g(left_arr, right_arr)) / conversion_rate)).toFixed(2) +
        `.</p><p>Press the SPACE BAR to continue.</p>`;
    },
    on_finish: function () {
      jsPsych.data.addProperties({
        compensation: Number(((g(left_arr, right_arr)) / conversion_rate)).toFixed(2),
      });
    }
  };

  var reward_FR_is_correct;




  if (fixedfirst) {
    timeline.push(reward_fixedfirst)
  }
  if (fixedfirst == false) {
    timeline.push(reward_valuefirst)
  }


  timeline.push(cursor_on);

  var demo_trial = {
    type: "survey-text",
    preamble: "<p>Please answer the following demographic questions</p>",
    questions: [
      { prompt: "What is your worker ID?", name: "workerID" },
      { prompt: "What is your age?", name: "Age" },
      {
        prompt:
          "What is your gender identify? (Female/Male/Non-binary/Other/Prefer not to say)",
        name: "Gender",
      },
      {
        prompt: "Do you have full color vision? (Yes/No)",
        name: "colorblind",
      },
    ],
  };
  timeline.push(demo_trial);

  jsPsych.init({
    timeline,
    on_finish: function () {
      jsPsych.data.addProperties({
        subject: subject_id,
      });
      $.ajax({
        type: "POST",
        url: "/experiment-data",
        data: JSON.stringify(jsPsych.data
          .get()
          .filter([
            { trial_type: "blocks" },
            { trial_type: "blocks-exp" },
            { trial_type: "reward-function" },
            { trial_type: "call" },
            { trial_type: "survey-text" },
            { trial_type: "memslider" },
            { trial_type: "memchoice" }])
          .ignore("trial_index")
          .ignore("internal_node_id")
          .values()
        ),
        contentType: "application/json",
        success: window.location.href = "finish"
      }).fail(function () {
        alert("A problem occurred while writing to the database. Please contact the researcher for more information.")
        window.location.href = "/";
      });
    }
  });
</script>

</html>